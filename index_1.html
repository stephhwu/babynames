<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Yearly Name Constellation</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      .star {
        stroke: none;
        cursor: pointer;
      }
      .line {
        stroke-width: 1px;
        opacity: 0.5;
      }
      .year-label {
        font-size: 24px;
        fill: white;
      }
      .name-label {
        font-size: 10px;
        fill: white;
      }
      .timeline {
        display: flex;
        justify-content: center;
        margin-top: 10px;
      }
      .year-button {
        color: white;
        margin: 0 5px;
        cursor: pointer;
      }
      .year-button:hover {
        font-weight: bold;
        color: lightblue;
      }
      .search-box {
        margin-top: 10px;
      }
    </style>
  </head>
  <body
    style="
      background: black;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    "
  >
    <svg id="constellation" width="800" height="600"></svg>
    <div id="timeline" class="timeline"></div>
    <input
      type="text"
      id="nameSearch"
      class="search-box"
      placeholder="Search for a name..."
    />

    <script>
      const svg = d3.select("#constellation");
      const width = 800;
      const height = 600;
      const centerX = width / 2;
      const centerY = height / 2;
      const maxRadius = Math.min(width, height) / 2 - 50;

      const yearLabel = svg
        .append("text")
        .attr("class", "year-label")
        .attr("x", width - 100)
        .attr("y", 50)
        .text("");

      d3.csv("Popular_Baby_Names_20241011.csv").then((data) => {
        data = data.slice(0, 60000);

        // Define colors for each ethnicity
        const ethnicityColors = d3.scaleOrdinal(d3.schemeCategory10);

        // Assign each name a random position within a circular area
        data.forEach((d) => {
          d.Rank = +d.Rank;
          d.Count = +d.Count;
          const angle = Math.random() * 2 * Math.PI;
          const radius = Math.sqrt(Math.random()) * maxRadius;
          d.x = centerX + radius * Math.cos(angle);
          d.y = centerY + radius * Math.sin(angle);
        });

        const years = [...new Set(data.map((d) => d["Year of Birth"]))];

        // Draw all stars with ethnicity-based colors
        const stars = svg
          .selectAll(".star")
          .data(data, (d) => d["Child's First Name"])
          .join("circle")
          .attr("class", "star")
          .attr("cx", (d) => d.x)
          .attr("cy", (d) => d.y)
          .attr("r", 2)
          .attr("fill", (d) => ethnicityColors(d.Ethnicity))
          .attr("opacity", 1)
          .on("mouseover", function (event, d) {
            svg
              .append("text")
              .attr("class", "name-label")
              .attr("x", d.x + 4)
              .attr("y", d.y - 4)
              .text(d["Child's First Name"]);
          })
          .on("mouseout", function () {
            svg.selectAll(".name-label").remove();
          });

        // Create timeline buttons
        const timeline = d3.select("#timeline");
        years.forEach((year) => {
          timeline
            .append("span")
            .attr("class", "year-button")
            .text(year)
            .on("click", () => drawTopNamesForYear(year));
        });

        function drawTopNamesForYear(year) {
          svg.selectAll(".line").remove();
          svg.selectAll(".name-label").remove();

          const yearData = data
            .filter((d) => d["Year of Birth"] == year)
            .sort((a, b) => a.Rank - b.Rank)
            .slice(0, 10);

          yearLabel.text(year);

          const colorScale = d3
            .scaleSequential(d3.interpolateCool)
            .domain([1, 10]);

          // Draw lines connecting the top 10 names
          svg
            .selectAll(".line")
            .data(d3.pairs(yearData))
            .join("line")
            .attr("class", "line")
            .attr("x1", (d) => d[0].x)
            .attr("y1", (d) => d[0].y)
            .attr("x2", (d) => d[1].x)
            .attr("y2", (d) => d[1].y)
            .attr("stroke", (d, i) => colorScale(i));

          // Highlight the top 10 names
          svg
            .selectAll(".star")
            .attr("opacity", 0.2) // Fade out all other names
            .filter((d) => yearData.includes(d))
            .attr("opacity", 1)
            .attr("r", 4); // Increase size for the top names

          svg
            .selectAll(".name-label")
            .data(yearData, (d) => d["Child's First Name"])
            .join("text")
            .attr("class", "name-label")
            .attr("x", (d) => d.x + 4)
            .attr("y", (d) => d.y - 4)
            .text((d) => d["Child's First Name"]);
        }

        d3.select("#nameSearch").on("input", function () {
          const searchTerm = this.value.toLowerCase();
          svg.selectAll(".star").attr("opacity", 0.2).attr("r", 2);

          const filteredData = data.filter((d) =>
            d["Child's First Name"].toLowerCase().includes(searchTerm)
          );

          svg
            .selectAll(".star")
            .data(filteredData, (d) => d["Child's First Name"])
            .attr("fill", "yellow")
            .attr("opacity", 1)
            .attr("r", 4);

          svg
            .selectAll(".name-label")
            .data(filteredData, (d) => d["Child's First Name"])
            .join("text")
            .attr("class", "name-label")
            .attr("x", (d) => d.x + 4)
            .attr("y", (d) => d.y - 4)
            .text((d) => d["Child's First Name"]);
        });
      });
    </script>
  </body>
</html>
